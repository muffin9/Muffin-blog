---
date: '2022-01-19'
title: '[React] - 상태관리'
categories: ['React', '상태관리']
summary: 'React 어플리케이션을 만들면서 상태관리를 어떻게 설계하면 좋을까?'
thumbnail: 'images/ReactLogo.png'
---

## 상태관리 ?

프론트엔드 리액트를 주로 어플리케이션을 만들면서 상태관리 도구들이 정말정말 많다. 그래서 이 많은 상태관리 도구들 중 과연 어느 상황에 어떤걸 사용하는게 좋을지 정리해보고자 한다.

지금까지 여러가지 상태관리를 써오면서 여러 글들을 참고한 의견고 개인적인 느낀점들을 공유하고자 하는게 이 글의 목적이라고 보시면 될듯하다.

먼저 그럼 상태를 의미하는 State. 정확히 무슨 의미일까 ?

리액트 공식문서에 따르면 Component State를 다음과 같이 설명한다.  
https://reactjs.org/docs/faq-state.html

=> 상태는 컴포넌트 내부에서 관리되어지며, 어플리케이션의 렌더링에 영향을 미치는 플레인 자바스크립트 객체다. 간단히 말하자면 "변화하는 데이터"라고 보면 되겠다.

이렇게, 상태는 어플리케이션의 규모가 커질수록 당영히 관리해야하는 상태들이 많아지는데 만약 여러 컴포넌트에서 동일하게 공유되어지는 데이터(상태)일 경우 똑같은 상태를 유지되어야 함을 보장해야 한다. 이걸 줄여서 상태의 일관성이라고도 하는데, 이 상태의 일관성은 사용자 입장에서나 우리 개발자 입장에서 봤을때 굉장히 중요하다. 왜냐하면 만약 내가 특정 글에 좋아요를 눌렀는데 어떤 컴포넌트에서는 좋아요가 올라갔는데 어떤 컴포넌트는 올라가지 않는다면? 그렇다... 굉장히 사용자입자에선 혼란스러워질테고 개발자들도 이런 일이 발생하지 않도록 해야 한다. => 즉 동일한 데이터는 항상 같은 곳에서 데이터를 가져와야 한다.

## 상태의 종류

상태는 먼저 흔히 전역상태, 지역상태, 컴포넌트 간 상태로 나눠보자.

전역상태 ? 어플리케이션 맨 상위에서 관리되어지는 상태이며 흔히 로그인 이후에 유지되어야 하는 유저정보가 있다. 컴포넌트 간 Prop Drilling으로 전달해줄 수도 있지만 가급적 전역상태는 어디서 사이드 이펙트가 발생할지도 모르기 때문에 안쓰려고 노력한다. 만약 Prop Drilling 깊어진다고 생각이 들면 컴포넌트를 다시 설계하거나 Context API, Redux, Recoil 과 같은 도구들의 힘을 빌려야한다.

지역상태 ? 특정 컴포넌트 안에서만 관리되는 상태를 의미한다. 다른 컴포넌트들과 데이터를 공유하지 않으며 대표적으로 Form 데이터가 있을것 같다. 요즘에는 함수형 컴포넌트 기반인 Hooks 문법을 많이 사용하여 useState로 많이 관리하는 추세다.

컴포넌트 간 상태 ? 여러 컴포넌트에서 동시에 관리되는 상태를 나타낸다. 주로 Prop Drilling으로 넘겨 관리하는데, 넘기는 depth는 2번을 초과하지 않도록 하는게 좋으며 그렇지 않다면 먼저 컴포넌트를 내가 잘 설계 되었는지 의심을 해야하고, 이미 커져버린 어플리케이션이라면? 전역상태로 빼서 관리하는게 유지보수 측면에서 더 좋을때가 있었다.

## Context API

Context API는 리액트에서 만들었는데, 흔히들 전역상태를 공유하는 상태 도구라고 알려져있는데 이는 반은맞고 반은 틀린 잘못된 정보이다. 왜냐면 Context API는 종속성을 주입하기위한 도구일뿐, React에서의 실질적인 상태관리는 useState, useReducer를 통해 일어나기 때문이다. 그리고 Context로 관리할 컴포넌트들을 Provider로 감싸 묶어서 관리하기 때문에 전역이라는 느낌보다는 "특정 데이터들"을 공유하는 컴포넌트들을 대표하는 "컴포넌트"의 상태를 관리하는 느낌이 더 강하다. 약간 부분 집합같은 느낌이라고 느꼈다.  
이 컴포넌트 간 집합의 범위를 제대로 지정하지 않는다면, 불필요한 rerender를 일으키기 때문에 "컴포넌트 설계"가 우선순위라는거 잊지말자.

## Redux

리액트에만 존재하는 Context-API와는 달리 리덕스는 순수 바닐라 자바스크립트에서도 사용 가능한 약간 무거운 라이브러리다.
Redux는 전역 상태관리를 위한 도구로, 중앙에 스토어라는 녀석들 두어서 여기서 전체적으로 상태를 관리한다. Flux 패턴을 따라 단방향으로 흐르기 때문엥 디버깅하기가 좋다는 장점이 존재한다.  
리덕스에 관련하여 더 학습하거나 알고싶으시면 이 분의 글을 참고하는게 좋다.  
[리덕스 알아보기](https://medium.com/@ca3rot/%EC%95%84%EB%A7%88-%EC%9D%B4%EA%B2%8C-%EC%A0%9C%EC%9D%BC-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-%EC%89%AC%EC%9A%B8%EA%B1%B8%EC%9A%94-react-redux-%ED%94%8C%EB%A1%9C%EC%9A%B0%EC%9D%98-%EC%9D%B4%ED%95%B4-1585e911a0a6)

하지만 요즘에는 잘 안쓰는 추세이고 나도 한 번 사용해봤지만, 비동기 통신을 위해서 다른 라이브러리를 같이 사용해야 하는데 이 코드들을 하나하나 추가적으로 작성해 나가는게 불편했었다. 레거시 코드가 아닌이상 앞으로도 쓸 일은 많이 없지 않을까 생각한다.

## Recoil

리코일을 요약해서 정리 하자면, Atom의 상태가 변경되면 구독하고 있는 컴포너트들의 다시 랜더링되면서 변경된 Atom의 상태를 공유하게 된다. 또한 selector는 순수함수로서 Atom이나 또 다른 selector를 이용해서 새로운 데이터를 전달해줄 수 있다. selector를 이용하면 연관된 Atom과 selector가 변경되면 그 따른 변경된 값을 즉시 받을 수 있고 이 selector를 사용하는 컴포넌트도 다시 랜더링된다. selector에서는 async를 이용해 비동기 작업 또한 가능하다. 서버에서 api로 데이터를 불러오는 것도 가능하다.

> 하지만, react-query와 비교해봤을땐 recoil-selector의 단점으로는 리패칭을 자동으로 시킬 수 없다는 점이 존재한다.

`그런데 나는 Recoil을 거의 사용하지 않았다.` 프로젝트를 진행하면서 막상 `비동기 관련 통신은 react-query`를, 최대한 전역상태를 사용하지 않기 위해 컴포넌트를 잘 분리하면서 개발을 진행하다보니 이 reocil은 여러 컴포넌트에서 상태를 공유해야하는 최근검색어 상태에서만 사용했다.

> 최근검색어 기능을 나는 인풋창과 인풋을 포커싱했을때 밑에 나오는 최근검색어 컴포넌트가 분리하여 작업했는데 인풋창에 검색어 입력시 → 바로 최근검색어가 상태를 받을 수 있도록 공유하였다.

## React-query

Server State를 관리하는 라이브러리로 React 프로젝트에서 Server와 Client 사이 비동기 로직들을 손쉽게 다루게 해주는 도구다.

> Server State를 관리하는 라이브러리로 React 프로젝트에서 Server와 Client 사이 비동기 로직들을 손쉽게 다루게 해주는 도구

이런 프론트엔드에서 어려운 부분 중 하나가, 비동기 요청을 통해 서버 상태를 가져오고 관리하고 업데이트 하는 부분인데, 이런 부분들을 쉽게 도와준다. 대표적인 장점은 다음과 같ㄷ.ㅏ

1. 데이터를 캐싱한다는 가장 큰 장점을 지니고 있다. 이 react-query는 기본적으로 데이터를 fetching 해온 후 데이터를 캐싱하며 유통기한이 지나거나 데이터가 바뀌었을때, refetching할 수가 있다.

2. 서버데이터와 클라이언트 데이터를 완전하게 분리할 수가 있다. ⇒ 나도 이부분에 동감한다. 훅 인터페이스인 useQuery와 useMutation 함수로 서버에게 요청이후에 데이터를 받아와 바로 컴포넌트에 뿌려줄 수 있다는 장점으로 유지보수도 굉장히 좋았으며, 코드 디버깅하기에도 굉장히 좋았다.

3. 만약 Redux 를 사용하다 보면 서버 데이터를 받아와 상태 관리를 하기 위해 Redux-saga 를 사용하게 되고, Client Side 에서 전역 상태 관리를 위해서 사용하는 라이브러리가 의도와는 다르게 비동기 요청을 위한 로직으로 Store 혹은 module 이 비대해지게 된다. (비동기 요청을 위해 request.success, request.fail 상태의 로직도 다뤄야 하며, 이 전체적인 과정을 Redux 모듈에서 관리하려니 보일러 플레이트가 관리하기 어려울 정도로 커지는건 당연한 상황…)

배민 기술블로그에서 다음과 같이 정리학늘을 보았다. 애초에 리덕스는 비동기 통신이 아닌 전역 상태 관리를 위함인데 우리는 왜 굳이 이들을 비동기 통신에 활용하고 있을까 ⇒ react-query를 사용하면 온전한 Client Side 데이터만 전역 상태 관리로 탈바꿈 할 수 있다.

또한, react-query 단점이라면? 코드 구조를 훨씬 잘 짜야 한다. 왜냐면? 아무 컴포넌트에서나 이 react-query로 데이터 패칭을 하게 되면 어디서 쓰이고 있는지 파악이 더 힘들어질 수 있을 것 같다. 이 부분은 팀과 적절하게 상의하여 비동기 통신을 하기 위한 컴포넌트를 잘 설계하는게 중요하다 생각이든다.

실제로 reacy-query는 요즘 핫한 기술인만큼 더 깊게 파헤쳐 학습할 가치가 있는 기술이라 생각이든다. 나도 이번에 프로젝트를 진행하면서 도입하여 학습해봤는데 리패칭하는 기술과 데이터를 바로 받아와 컴포넌트에 뿌려줄 수 있다는게 너무 좋았고 코드가 매우 깔끔해졌다고 느꼈다.

마지막으로, 비동기 통신에서 사용되어지는 reacy-query와 비슷한 녀석들을 비교해보자.

캐싱이 이루어지기 전, **fetch**가 빨리 이루어지는 순

**recoil selector > swr > react-query**

서버의 데이터가 바뀌었을 때, **refetch, 업데이트**가 빨리 이루어지는 순

**react-query > swr** (recoil selector 함수론 리패칭 불가.)

또 갑자기 어떤 상태 라이브러리가 나올진 모르겠지만 이렇게 많고많은 상태 라이브러리중에 내가 구현하는 프로젝트에 가장 맞는 상태들을 적절하게 섞어 쓰는것이 중요하다는거 잊지말자.

**요약하자면 현재 나는 컴포넌트간 상태는 컴포넌트 재설계 + useState, 서버 상태는 reacy-query를, 전역상태를 정말 사용해야 한다면 recoil를 사용하고 있다.**

다음은 상태관리를 공부하면서 도움이된 글들과 출처 입니다.

React Query로 서버 상태 관리 - https://blog.rhostem.com/posts/2021-02-01T00:00:00.000Z  
React-query로 비동기 통신 분리하기 - https://techblog.woowahan.com/6339/
